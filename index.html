<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Clube Gestor 360 - Sistema de Gest√£o Modular</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0F766E">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Sistema modular de gest√£o para clubes e complexos de lazer">
    
    <!-- Scripts -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Nunito Sans', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#F0FDFA',
                            100: '#CCFBF1',
                            200: '#99F6E4',
                            300: '#5EEAD4',
                            400: '#2DD4BF',
                            500: '#14B8A6',
                            600: '#0D9488',
                            700: '#0F766E',
                            800: '#115E59',
                            900: '#134E4A',
                        },
                    },
                }
            }
        }
    </script>
    
    <style>
        * { font-family: 'Nunito Sans', system-ui, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: #f8fafc; }
        .pb-safe { padding-bottom: max(0.5rem, env(safe-area-inset-bottom, 0px)); }
        
        @keyframes modal-in {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        @keyframes slide-down {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.95); opacity: 1; }
            100% { transform: scale(1.3); opacity: 0; }
        }
        .animate-modal-in { animation: modal-in 0.25s ease-out forwards; }
        .animate-slide-down { animation: slide-down 0.3s ease-out forwards; }
        .animate-pulse-ring { animation: pulse-ring 1.5s ease-out infinite; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        @media (max-width: 768px) {
            ::-webkit-scrollbar { display: none; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, createContext, useContext, useCallback } = React;

        // ============================================
        // CONTEXTO GLOBAL DO SISTEMA
        // ============================================
        const ClubeContext = createContext();

        // ============================================
        // DADOS INICIAIS DO SISTEMA
        // ============================================
        const initialConfigGlobal = {
            id: 1,
            nome_clube: 'Clube Esportivo Horizonte',
            pix_chave: 'contato@clubehorizonte.com.br',
            logo_url: null,
            cor_primaria: '#0F766E',
            punicao_noshow_limite: 3,
            punicao_dias_bloqueio: 7
        };

        // M√ìDULOS COM CONFIGURA√á√ÉO DE FILA
        const initialModulos = [
            { 
                id: 1, 
                nome_categoria: 'T√™nis', 
                icone: 'üéæ', 
                status_ativo: true, 
                tipo_cobranca: 'Gratuito', 
                valor_padrao: 0, 
                unidade_tempo: 60, 
                antecedencia_maxima: 48, 
                janela_cancelamento: 2,
                // NOVAS CONFIGS DE FILA
                fila_habilitada: true,
                tipo_fila: 'checkin', // 'checkin' ou 'agendamento'
                antecedencia_fila_minutos: 30 // tempo antes do hor√°rio que pode entrar na fila
            },
            { 
                id: 2, 
                nome_categoria: 'Futebol', 
                icone: '‚öΩ', 
                status_ativo: true, 
                tipo_cobranca: 'Gratuito', 
                valor_padrao: 0, 
                unidade_tempo: 90, 
                antecedencia_maxima: 72, 
                janela_cancelamento: 4,
                fila_habilitada: true,
                tipo_fila: 'agendamento',
                antecedencia_fila_minutos: 60
            },
            { 
                id: 3, 
                nome_categoria: 'Quiosque', 
                icone: 'üè†', 
                status_ativo: true, 
                tipo_cobranca: 'Pago', 
                valor_padrao: 350, 
                unidade_tempo: 'Di√°ria', 
                antecedencia_maxima: 720, 
                janela_cancelamento: 48,
                fila_habilitada: false,
                tipo_fila: 'agendamento',
                antecedencia_fila_minutos: 0
            },
            { 
                id: 4, 
                nome_categoria: 'Sal√£o de Festas', 
                icone: 'üéâ', 
                status_ativo: true, 
                tipo_cobranca: 'Pago', 
                valor_padrao: 800, 
                unidade_tempo: 'Di√°ria', 
                antecedencia_maxima: 720, 
                janela_cancelamento: 72,
                fila_habilitada: false,
                tipo_fila: 'agendamento',
                antecedencia_fila_minutos: 0
            },
            { 
                id: 5, 
                nome_categoria: 'Piscina', 
                icone: 'üèä', 
                status_ativo: false, 
                tipo_cobranca: 'Gratuito', 
                valor_padrao: 0, 
                unidade_tempo: 120, 
                antecedencia_maxima: 24, 
                janela_cancelamento: 1,
                fila_habilitada: false,
                tipo_fila: 'checkin',
                antecedencia_fila_minutos: 15
            },
            { 
                id: 6, 
                nome_categoria: 'Academia', 
                icone: 'üèãÔ∏è', 
                status_ativo: false, 
                tipo_cobranca: 'Gratuito', 
                valor_padrao: 0, 
                unidade_tempo: 60, 
                antecedencia_maxima: 24, 
                janela_cancelamento: 1,
                fila_habilitada: false,
                tipo_fila: 'checkin',
                antecedencia_fila_minutos: 15
            },
        ];

        const initialRecursos = [
            { id: 1, id_modulo: 1, nome_identificador: 'Quadra de T√™nis 01', capacidade: 4, status_operacional: 'Ativo' },
            { id: 2, id_modulo: 1, nome_identificador: 'Quadra de T√™nis 02', capacidade: 4, status_operacional: 'Ativo' },
            { id: 3, id_modulo: 1, nome_identificador: 'Quadra de T√™nis 03', capacidade: 4, status_operacional: 'Manutencao' },
            { id: 4, id_modulo: 2, nome_identificador: 'Campo Society 01', capacidade: 14, status_operacional: 'Ativo' },
            { id: 5, id_modulo: 2, nome_identificador: 'Campo Society 02', capacidade: 14, status_operacional: 'Ativo' },
            { id: 6, id_modulo: 3, nome_identificador: 'Quiosque 01 - Lago', capacidade: 30, status_operacional: 'Ativo' },
            { id: 7, id_modulo: 3, nome_identificador: 'Quiosque 02 - Jardim', capacidade: 25, status_operacional: 'Ativo' },
            { id: 8, id_modulo: 3, nome_identificador: 'Quiosque 03 - Piscina', capacidade: 40, status_operacional: 'Ativo' },
            { id: 9, id_modulo: 4, nome_identificador: 'Sal√£o Principal', capacidade: 150, status_operacional: 'Ativo' },
            { id: 10, id_modulo: 4, nome_identificador: 'Sal√£o Anexo', capacidade: 80, status_operacional: 'Ativo' },
        ];

        const initialUsuarios = [
            { id: 1, nome: 'Admin Master', matricula: 'ADM001', role: 'Admin', contador_noshow: 0, bloqueado_ate: null },
            { id: 2, nome: 'Jo√£o Recep√ß√£o', matricula: 'FUNC001', role: 'Funcionario', contador_noshow: 0, bloqueado_ate: null },
            { id: 3, nome: 'Maria Silva', matricula: 'SOC001', role: 'Socio', contador_noshow: 0, bloqueado_ate: null },
            { id: 4, nome: 'Carlos Santos', matricula: 'SOC002', role: 'Socio', contador_noshow: 2, bloqueado_ate: null },
            { id: 5, nome: 'Ana Oliveira', matricula: 'SOC003', role: 'Socio', contador_noshow: 0, bloqueado_ate: null },
        ];

        // ============================================
        // FUN√á√ïES UTILIT√ÅRIAS
        // ============================================
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        }

        function formatDateBR(dateStr) {
            const [year, month, day] = dateStr.split('-');
            return `${day}/${month}/${year}`;
        }

        function formatDateTime(date) {
            return date.toLocaleString('pt-BR', { 
                day: '2-digit', 
                month: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function getTimeProgress(horaInicio, horaFim) {
            const now = new Date();
            const [startH, startM] = horaInicio.split(':').map(Number);
            const [endH, endM] = horaFim.split(':').map(Number);
            
            const start = new Date(now);
            start.setHours(startH, startM, 0);
            const end = new Date(now);
            end.setHours(endH, endM, 0);
            
            if (now < start) return 0;
            if (now > end) return 100;
            
            const total = end - start;
            const elapsed = now - start;
            return Math.round((elapsed / total) * 100);
        }

        function getProgressColor(progress) {
            if (progress < 50) return 'bg-emerald-500';
            if (progress < 80) return 'bg-amber-500';
            return 'bg-red-500';
        }

        // Gera hor√°rios de hora cheia e meia hora
        function gerarHorariosDisponiveis(modulo, recursoId, data, reservas) {
            const horarios = [];
            const duracao = typeof modulo.unidade_tempo === 'number' ? modulo.unidade_tempo : 60;
            
            // Hor√°rios: 06:00, 06:30, 07:00, 07:30, etc.
            for (let h = 6; h < 22; h++) {
                for (let m = 0; m < 60; m += 30) {
                    const hora = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
                    const horaFimMinutos = h * 60 + m + duracao;
                    const horaFimH = Math.floor(horaFimMinutos / 60);
                    const horaFimM = horaFimMinutos % 60;
                    const horaFim = `${String(horaFimH).padStart(2, '0')}:${String(horaFimM).padStart(2, '0')}`;
                    
                    // Verifica conflito com reservas existentes
                    const horaInicioNum = h * 60 + m;
                    const horaFimNum = horaFimMinutos;
                    
                    const conflito = reservas.some(r => {
                        if (r.id_recurso !== recursoId || r.data !== data || r.status === 'Cancelada' || r.status === 'No-Show') {
                            return false;
                        }
                        const [rStartH, rStartM] = r.hora_inicio.split(':').map(Number);
                        const [rEndH, rEndM] = r.hora_fim.split(':').map(Number);
                        const rStartNum = rStartH * 60 + rStartM;
                        const rEndNum = rEndH * 60 + rEndM;
                        
                        return (horaInicioNum < rEndNum && horaFimNum > rStartNum);
                    });
                    
                    if (!conflito && horaFimH <= 22) {
                        horarios.push({ inicio: hora, fim: horaFim });
                    }
                }
            }
            return horarios;
        }

        const generateInitialReservas = () => {
            const hoje = new Date();
            return [
                { id: 1, id_recurso: 1, id_usuario: 3, data: formatDate(hoje), hora_inicio: '08:00', hora_fim: '09:00', status: 'Confirmada', url_comprovante_pix: null, valor: 0 },
                { id: 2, id_recurso: 1, id_usuario: 4, data: formatDate(hoje), hora_inicio: '09:00', hora_fim: '10:00', status: 'Pendente', url_comprovante_pix: null, valor: 0 },
                { id: 3, id_recurso: 4, id_usuario: 5, data: formatDate(hoje), hora_inicio: '18:00', hora_fim: '19:30', status: 'Confirmada', url_comprovante_pix: null, valor: 0 },
                { id: 4, id_recurso: 6, id_usuario: 3, data: formatDate(addDays(hoje, 7)), hora_inicio: '08:00', hora_fim: '22:00', status: 'Aguardando Aprova√ß√£o', url_comprovante_pix: 'comprovante_1.jpg', valor: 350 },
                { id: 5, id_recurso: 9, id_usuario: 4, data: formatDate(addDays(hoje, 14)), hora_inicio: '08:00', hora_fim: '22:00', status: 'Confirmada', url_comprovante_pix: 'comprovante_2.jpg', valor: 800 },
            ];
        };

        // FILA DE ESPERA INICIAL
        const generateInitialFilaEspera = () => {
            const hoje = new Date();
            return [
                { 
                    id: 1, 
                    id_modulo: 1, // T√™nis
                    id_recurso: null, // null = qualquer quadra
                    id_usuario: 5, // Ana
                    data: formatDate(hoje),
                    horario_desejado: '10:00',
                    created_at: new Date(hoje.getTime() - 30 * 60000).toISOString(), // 30 min atr√°s
                    status: 'Aguardando', // 'Aguardando', 'Atendido', 'Cancelado', 'Expirado'
                    tipo_entrada: 'checkin' // 'checkin' ou 'agendamento'
                },
                { 
                    id: 2, 
                    id_modulo: 1,
                    id_recurso: 1, // Quadra espec√≠fica: Quadra 01
                    id_usuario: 4, // Carlos
                    data: formatDate(hoje),
                    horario_desejado: '10:00',
                    created_at: new Date(hoje.getTime() - 15 * 60000).toISOString(), // 15 min atr√°s
                    status: 'Aguardando',
                    tipo_entrada: 'checkin'
                },
            ];
        };

        // ============================================
        // COMPONENTES DE UI
        // ============================================
        const Card = ({ children, className = '', onClick }) => (
            <div 
                className={`bg-white rounded-2xl shadow-sm border border-slate-100 ${onClick ? 'cursor-pointer hover:shadow-md transition-shadow' : ''} ${className}`}
                onClick={onClick}
            >
                {children}
            </div>
        );

        const Button = ({ children, variant = 'primary', size = 'md', className = '', ...props }) => {
            const variants = {
                primary: 'bg-teal-600 hover:bg-teal-700 text-white shadow-sm',
                secondary: 'bg-slate-100 hover:bg-slate-200 text-slate-700',
                danger: 'bg-red-500 hover:bg-red-600 text-white',
                success: 'bg-emerald-500 hover:bg-emerald-600 text-white',
                warning: 'bg-amber-500 hover:bg-amber-600 text-white',
                ghost: 'hover:bg-slate-100 text-slate-600',
                purple: 'bg-purple-500 hover:bg-purple-600 text-white',
            };
            
            const sizes = {
                sm: 'px-3 py-1.5 text-sm',
                md: 'px-4 py-2.5 text-sm',
                lg: 'px-6 py-3 text-base',
            };
            
            return (
                <button 
                    className={`font-semibold rounded-xl transition-all duration-200 active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed ${variants[variant]} ${sizes[size]} ${className}`}
                    {...props}
                >
                    {children}
                </button>
            );
        };

        const Badge = ({ children, variant = 'default', size = 'md' }) => {
            const variants = {
                default: 'bg-slate-100 text-slate-700',
                success: 'bg-emerald-100 text-emerald-700',
                warning: 'bg-amber-100 text-amber-700',
                danger: 'bg-red-100 text-red-700',
                info: 'bg-blue-100 text-blue-700',
                purple: 'bg-purple-100 text-purple-700',
            };
            
            const sizes = {
                sm: 'px-2 py-0.5 text-xs',
                md: 'px-2.5 py-1 text-xs',
            };
            
            return (
                <span className={`font-semibold rounded-full ${variants[variant]} ${sizes[size]}`}>
                    {children}
                </span>
            );
        };

        const Toggle = ({ checked, onChange, label }) => (
            <label className="flex items-center gap-3 cursor-pointer">
                <div className="relative">
                    <input 
                        type="checkbox" 
                        checked={checked} 
                        onChange={(e) => onChange(e.target.checked)}
                        className="sr-only"
                    />
                    <div className={`w-12 h-6 rounded-full transition-colors ${checked ? 'bg-teal-500' : 'bg-slate-300'}`}>
                        <div className={`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-sm transition-transform ${checked ? 'translate-x-6' : ''}`} />
                    </div>
                </div>
                {label && <span className="text-sm font-medium text-slate-700">{label}</span>}
            </label>
        );

        const Input = ({ label, ...props }) => (
            <div className="space-y-1.5">
                {label && <label className="text-sm font-medium text-slate-700">{label}</label>}
                <input 
                    className="w-full px-4 py-2.5 rounded-xl border border-slate-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-500/20 outline-none transition-all text-slate-800"
                    {...props}
                />
            </div>
        );

        const Select = ({ label, options, ...props }) => (
            <div className="space-y-1.5">
                {label && <label className="text-sm font-medium text-slate-700">{label}</label>}
                <select 
                    className="w-full px-4 py-2.5 rounded-xl border border-slate-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-500/20 outline-none transition-all text-slate-800 bg-white"
                    {...props}
                >
                    {options.map(opt => (
                        <option key={opt.value} value={opt.value}>{opt.label}</option>
                    ))}
                </select>
            </div>
        );

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-slate-900/50 backdrop-blur-sm" onClick={onClose} />
                    <div className="relative bg-white rounded-2xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-hidden animate-modal-in">
                        <div className="flex items-center justify-between p-4 border-b border-slate-100">
                            <h3 className="text-lg font-bold text-slate-800">{title}</h3>
                            <button onClick={onClose} className="p-2 hover:bg-slate-100 rounded-xl transition-colors">
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <div className="p-4 overflow-y-auto max-h-[calc(90vh-80px)]">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        const TabBar = ({ tabs, active, onChange }) => (
            <div className="flex bg-slate-100 rounded-xl p-1 overflow-x-auto">
                {tabs.map(tab => (
                    <button
                        key={tab.id}
                        onClick={() => onChange(tab.id)}
                        className={`flex-1 px-3 py-2 rounded-lg text-sm font-semibold transition-all whitespace-nowrap ${
                            active === tab.id 
                                ? 'bg-white text-teal-700 shadow-sm' 
                                : 'text-slate-600 hover:text-slate-800'
                        }`}
                    >
                        {tab.label}
                    </button>
                ))}
            </div>
        );

        const ProgressBar = ({ value, color }) => (
            <div className="h-2 bg-slate-200 rounded-full overflow-hidden">
                <div 
                    className={`h-full ${color} transition-all duration-500`}
                    style={{ width: `${value}%` }}
                />
            </div>
        );

        const StatusBadge = ({ status }) => {
            const config = {
                'Pendente': { variant: 'warning', label: 'Pendente' },
                'Confirmada': { variant: 'success', label: 'Confirmada' },
                'No-Show': { variant: 'danger', label: 'No-Show' },
                'Finalizada': { variant: 'default', label: 'Finalizada' },
                'Aguardando Aprova√ß√£o': { variant: 'info', label: 'Aguardando' },
                'Cancelada': { variant: 'danger', label: 'Cancelada' },
                'Aguardando': { variant: 'purple', label: 'Na Fila' },
                'Atendido': { variant: 'success', label: 'Atendido' },
                'Expirado': { variant: 'default', label: 'Expirado' },
            };
            
            const { variant, label } = config[status] || { variant: 'default', label: status };
            return <Badge variant={variant}>{label}</Badge>;
        };

        const Notification = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);
            
            const colors = {
                success: 'bg-emerald-500',
                warning: 'bg-amber-500',
                error: 'bg-red-500',
            };
            
            return (
                <div className={`fixed top-4 left-4 right-4 z-50 p-4 rounded-xl text-white font-medium shadow-lg animate-slide-down ${colors[type]}`}>
                    {message}
                </div>
            );
        };

        // ============================================
        // COMPONENTES PRINCIPAIS
        // ============================================

        // HEADER NAVIGATION
        const Header = ({ currentUser, onLogout }) => (
            <header className="bg-white border-b border-slate-100 sticky top-0 z-40">
                <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <div className="w-10 h-10 bg-gradient-to-br from-teal-500 to-emerald-600 rounded-xl flex items-center justify-center text-white font-bold text-lg">
                            C
                        </div>
                        <div>
                            <h1 className="font-bold text-slate-800 leading-tight">Clube Gestor 360</h1>
                            <p className="text-xs text-slate-500">{currentUser.nome}</p>
                        </div>
                    </div>
                    
                    <div className="flex items-center gap-2">
                        <Badge variant={currentUser.role === 'Admin' ? 'purple' : currentUser.role === 'Funcionario' ? 'info' : 'success'}>
                            {currentUser.role}
                        </Badge>
                        <button 
                            onClick={onLogout}
                            className="p-2 hover:bg-slate-100 rounded-xl transition-colors text-slate-500"
                        >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                            </svg>
                        </button>
                    </div>
                </div>
            </header>
        );

        // BOTTOM NAVIGATION (MOBILE)
        const BottomNav = ({ currentView, onNavigate, role }) => {
            const navItems = [
                { id: 'home', icon: 'üè†', label: 'In√≠cio' },
                { id: 'reservas', icon: 'üìÖ', label: 'Reservas' },
                { id: 'fila', icon: '‚è≥', label: 'Fila' },
                ...(role !== 'Socio' ? [{ id: 'lousa', icon: 'üìã', label: 'Lousa' }] : []),
                ...(role === 'Admin' ? [{ id: 'config', icon: '‚öôÔ∏è', label: 'Config' }] : []),
            ];
            
            return (
                <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-100 pb-safe z-40">
                    <div className="flex justify-around py-2">
                        {navItems.map(item => (
                            <button
                                key={item.id}
                                onClick={() => onNavigate(item.id)}
                                className={`flex flex-col items-center gap-1 px-4 py-2 rounded-xl transition-colors ${
                                    currentView === item.id 
                                        ? 'text-teal-600' 
                                        : 'text-slate-400 hover:text-slate-600'
                                }`}
                            >
                                <span className="text-xl">{item.icon}</span>
                                <span className="text-xs font-medium">{item.label}</span>
                            </button>
                        ))}
                    </div>
                </nav>
            );
        };

        // TELA DE LOGIN
        const TelaLogin = ({ usuarios, onLogin }) => (
            <div className="min-h-screen bg-gradient-to-br from-teal-500 to-emerald-600 flex items-center justify-center p-4">
                <Card className="w-full max-w-sm p-6">
                    <div className="text-center mb-6">
                        <div className="w-16 h-16 bg-gradient-to-br from-teal-500 to-emerald-600 rounded-2xl flex items-center justify-center text-white font-bold text-2xl mx-auto mb-4">
                            C
                        </div>
                        <h1 className="text-xl font-bold text-slate-800">Clube Gestor 360</h1>
                        <p className="text-sm text-slate-500">Selecione um usu√°rio para entrar</p>
                    </div>
                    
                    <div className="space-y-3">
                        {usuarios.map(user => (
                            <button
                                key={user.id}
                                onClick={() => onLogin(user)}
                                className="w-full p-4 bg-slate-50 hover:bg-slate-100 rounded-xl flex items-center justify-between transition-colors"
                            >
                                <div className="text-left">
                                    <p className="font-semibold text-slate-800">{user.nome}</p>
                                    <p className="text-sm text-slate-500">{user.matricula}</p>
                                </div>
                                <Badge variant={user.role === 'Admin' ? 'purple' : user.role === 'Funcionario' ? 'info' : 'success'}>
                                    {user.role}
                                </Badge>
                            </button>
                        ))}
                    </div>
                </Card>
            </div>
        );

        // HOME DO S√ìCIO
        const HomeSocio = ({ modulos, onSelectModulo }) => {
            const modulosAtivos = modulos.filter(m => m.status_ativo);
            
            return (
                <div className="p-4 space-y-4">
                    <div>
                        <h2 className="text-xl font-bold text-slate-800">Ol√°! üëã</h2>
                        <p className="text-slate-500">O que voc√™ quer fazer hoje?</p>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-3">
                        {modulosAtivos.map(modulo => (
                            <Card 
                                key={modulo.id}
                                className="p-4 text-center"
                                onClick={() => onSelectModulo(modulo)}
                            >
                                <span className="text-4xl mb-2 block">{modulo.icone}</span>
                                <h3 className="font-semibold text-slate-800">{modulo.nome_categoria}</h3>
                                <p className="text-xs text-slate-500 mt-1">
                                    {modulo.tipo_cobranca === 'Pago' ? `R$ ${modulo.valor_padrao}` : 'Gratuito'}
                                </p>
                                {modulo.fila_habilitada && (
                                    <Badge variant="purple" size="sm">Fila</Badge>
                                )}
                            </Card>
                        ))}
                    </div>
                    
                    {modulosAtivos.length === 0 && (
                        <Card className="p-8 text-center">
                            <p className="text-slate-500">Nenhum m√≥dulo dispon√≠vel no momento.</p>
                        </Card>
                    )}
                </div>
            );
        };

        // TELA DE RESERVA DE RECURSO
        const ReservaRecurso = ({ modulo, recursos, reservas, currentUser, onReservar, onVoltar, onEntrarFila }) => {
            const [step, setStep] = useState('recurso');
            const [selectedRecurso, setSelectedRecurso] = useState(null);
            const [selectedData, setSelectedData] = useState(formatDate(new Date()));
            const [selectedHorario, setSelectedHorario] = useState(null);
            const [comprovante, setComprovante] = useState(null);
            
            const recursosDoModulo = recursos.filter(r => r.id_modulo === modulo.id && r.status_operacional === 'Ativo');
            
            const horariosDisponiveis = selectedRecurso 
                ? gerarHorariosDisponiveis(modulo, selectedRecurso.id, selectedData, reservas)
                : [];
            
            const handleConfirmar = () => {
                const novaReserva = {
                    id: Date.now(),
                    id_recurso: selectedRecurso.id,
                    id_usuario: currentUser.id,
                    data: selectedData,
                    hora_inicio: selectedHorario.inicio,
                    hora_fim: selectedHorario.fim,
                    status: modulo.tipo_cobranca === 'Pago' ? 'Aguardando Aprova√ß√£o' : 'Pendente',
                    url_comprovante_pix: comprovante,
                    valor: modulo.valor_padrao
                };
                onReservar(novaReserva);
            };
            
            return (
                <div className="p-4 space-y-4">
                    <button onClick={onVoltar} className="flex items-center gap-2 text-slate-600 font-medium">
                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                        </svg>
                        Voltar
                    </button>
                    
                    <div className="flex items-center gap-3">
                        <span className="text-3xl">{modulo.icone}</span>
                        <div>
                            <h2 className="text-xl font-bold text-slate-800">{modulo.nome_categoria}</h2>
                            <p className="text-sm text-slate-500">
                                {modulo.tipo_cobranca === 'Pago' ? `R$ ${modulo.valor_padrao}` : 'Gratuito'}
                                {typeof modulo.unidade_tempo === 'number' && ` ‚Ä¢ ${modulo.unidade_tempo} min`}
                            </p>
                        </div>
                    </div>

                    {/* Bot√£o de entrar na fila (se habilitado) */}
                    {modulo.fila_habilitada && (
                        <Card className="p-4 bg-purple-50 border-purple-200">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h4 className="font-semibold text-purple-800">‚è≥ Fila de Espera</h4>
                                    <p className="text-sm text-purple-600">
                                        {modulo.tipo_fila === 'checkin' 
                                            ? 'Check-in presencial dispon√≠vel'
                                            : 'Agende sua posi√ß√£o na fila'
                                        }
                                    </p>
                                </div>
                                <Button variant="purple" size="sm" onClick={() => onEntrarFila(modulo)}>
                                    Entrar na Fila
                                </Button>
                            </div>
                        </Card>
                    )}
                    
                    {/* STEP 1: ESCOLHER RECURSO */}
                    {step === 'recurso' && (
                        <div className="space-y-3">
                            <h3 className="font-semibold text-slate-700">Escolha o local:</h3>
                            {recursosDoModulo.map(recurso => (
                                <Card 
                                    key={recurso.id}
                                    className={`p-4 border-2 transition-all ${selectedRecurso?.id === recurso.id ? 'border-teal-500 bg-teal-50' : 'border-transparent'}`}
                                    onClick={() => setSelectedRecurso(recurso)}
                                >
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <h4 className="font-semibold text-slate-800">{recurso.nome_identificador}</h4>
                                            <p className="text-sm text-slate-500">Capacidade: {recurso.capacidade} pessoas</p>
                                        </div>
                                        {selectedRecurso?.id === recurso.id && (
                                            <div className="w-6 h-6 bg-teal-500 rounded-full flex items-center justify-center">
                                                <svg className="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                                                </svg>
                                            </div>
                                        )}
                                    </div>
                                </Card>
                            ))}
                            
                            <Button 
                                className="w-full mt-4" 
                                disabled={!selectedRecurso}
                                onClick={() => setStep('data')}
                            >
                                Continuar
                            </Button>
                        </div>
                    )}
                    
                    {/* STEP 2: ESCOLHER DATA */}
                    {step === 'data' && (
                        <div className="space-y-3">
                            <h3 className="font-semibold text-slate-700">Escolha a data:</h3>
                            <Input 
                                type="date"
                                value={selectedData}
                                onChange={(e) => setSelectedData(e.target.value)}
                                min={formatDate(new Date())}
                            />
                            
                            <div className="bg-amber-50 p-3 rounded-xl text-sm text-amber-700">
                                ‚è∞ Anteced√™ncia m√°xima: {modulo.antecedencia_maxima}h
                            </div>
                            
                            <div className="flex gap-2">
                                <Button variant="secondary" onClick={() => setStep('recurso')}>Voltar</Button>
                                <Button className="flex-1" onClick={() => setStep('horario')}>Continuar</Button>
                            </div>
                        </div>
                    )}
                    
                    {/* STEP 3: ESCOLHER HOR√ÅRIO */}
                    {step === 'horario' && (
                        <div className="space-y-3">
                            <h3 className="font-semibold text-slate-700">Escolha o hor√°rio:</h3>
                            <p className="text-sm text-slate-500">{selectedRecurso.nome_identificador} ‚Ä¢ {formatDateBR(selectedData)}</p>
                            
                            <div className="grid grid-cols-4 gap-2 max-h-64 overflow-y-auto">
                                {horariosDisponiveis.map(horario => (
                                    <button
                                        key={horario.inicio}
                                        onClick={() => setSelectedHorario(horario)}
                                        className={`p-2 rounded-xl text-sm font-medium transition-all ${
                                            selectedHorario?.inicio === horario.inicio
                                                ? 'bg-teal-500 text-white'
                                                : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                        }`}
                                    >
                                        {horario.inicio}
                                    </button>
                                ))}
                            </div>
                            
                            {horariosDisponiveis.length === 0 && (
                                <div className="text-center py-8 text-slate-400">
                                    <p>Nenhum hor√°rio dispon√≠vel nesta data.</p>
                                    {modulo.fila_habilitada && (
                                        <Button variant="purple" size="sm" className="mt-3" onClick={() => onEntrarFila(modulo)}>
                                            Entrar na Fila de Espera
                                        </Button>
                                    )}
                                </div>
                            )}
                            
                            <div className="flex gap-2">
                                <Button variant="secondary" onClick={() => setStep('data')}>Voltar</Button>
                                <Button 
                                    className="flex-1"
                                    disabled={!selectedHorario}
                                    onClick={() => modulo.tipo_cobranca === 'Pago' ? setStep('pagamento') : setStep('confirmacao')}
                                >
                                    Continuar
                                </Button>
                            </div>
                        </div>
                    )}
                    
                    {/* STEP 4: PAGAMENTO (APENAS PARA PAGOS) */}
                    {step === 'pagamento' && (
                        <div className="space-y-4">
                            <h3 className="font-semibold text-slate-700">Pagamento via PIX:</h3>
                            
                            <Card className="p-4 bg-slate-50">
                                <p className="text-sm text-slate-500 mb-2">Valor:</p>
                                <p className="text-3xl font-bold text-slate-800">R$ {modulo.valor_padrao},00</p>
                            </Card>
                            
                            <Card className="p-4">
                                <p className="text-sm text-slate-500 mb-2">Chave PIX:</p>
                                <div className="flex items-center gap-2">
                                    <code className="flex-1 bg-slate-100 px-3 py-2 rounded-lg text-sm font-mono truncate">
                                        contato@clubehorizonte.com.br
                                    </code>
                                    <Button variant="secondary" size="sm" onClick={() => navigator.clipboard?.writeText('contato@clubehorizonte.com.br')}>
                                        Copiar
                                    </Button>
                                </div>
                            </Card>
                            
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-2">
                                    Upload do Comprovante:
                                </label>
                                <div className="border-2 border-dashed border-slate-200 rounded-xl p-6 text-center">
                                    <input 
                                        type="file"
                                        accept="image/*"
                                        onChange={(e) => setComprovante(e.target.files?.[0]?.name || null)}
                                        className="hidden"
                                        id="comprovante"
                                    />
                                    <label htmlFor="comprovante" className="cursor-pointer">
                                        {comprovante ? (
                                            <div className="text-emerald-600">
                                                <p className="font-medium">‚úì {comprovante}</p>
                                                <p className="text-sm">Clique para trocar</p>
                                            </div>
                                        ) : (
                                            <div className="text-slate-400">
                                                <p className="text-2xl mb-2">üìé</p>
                                                <p className="font-medium">Clique para anexar</p>
                                            </div>
                                        )}
                                    </label>
                                </div>
                            </div>
                            
                            <div className="flex gap-2">
                                <Button variant="secondary" onClick={() => setStep('horario')}>Voltar</Button>
                                <Button 
                                    className="flex-1"
                                    disabled={!comprovante}
                                    onClick={() => setStep('confirmacao')}
                                >
                                    Continuar
                                </Button>
                            </div>
                        </div>
                    )}
                    
                    {/* STEP 5: CONFIRMA√á√ÉO */}
                    {step === 'confirmacao' && (
                        <div className="space-y-4">
                            <h3 className="font-semibold text-slate-700">Confirme sua reserva:</h3>
                            
                            <Card className="p-4 space-y-3">
                                <div className="flex justify-between">
                                    <span className="text-slate-500">Local:</span>
                                    <span className="font-medium text-slate-800">{selectedRecurso.nome_identificador}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-slate-500">Data:</span>
                                    <span className="font-medium text-slate-800">{formatDateBR(selectedData)}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-slate-500">Hor√°rio:</span>
                                    <span className="font-medium text-slate-800">{selectedHorario.inicio} - {selectedHorario.fim}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-slate-500">Valor:</span>
                                    <span className="font-medium text-slate-800">
                                        {modulo.tipo_cobranca === 'Pago' ? `R$ ${modulo.valor_padrao},00` : 'Gratuito'}
                                    </span>
                                </div>
                            </Card>
                            
                            <div className="flex gap-2">
                                <Button variant="secondary" onClick={() => setStep(modulo.tipo_cobranca === 'Pago' ? 'pagamento' : 'horario')}>Voltar</Button>
                                <Button className="flex-1" onClick={handleConfirmar}>
                                    Confirmar Reserva
                                </Button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // TELA DE ENTRAR NA FILA
        const TelaEntrarFila = ({ modulo, recursos, currentUser, filaEspera, onEntrar, onVoltar }) => {
            const [tipoEspera, setTipoEspera] = useState('qualquer'); // 'qualquer' ou 'especifica'
            const [selectedRecurso, setSelectedRecurso] = useState(null);
            const [selectedData, setSelectedData] = useState(formatDate(new Date()));
            const [selectedHorario, setSelectedHorario] = useState(null);
            
            const recursosDoModulo = recursos.filter(r => r.id_modulo === modulo.id && r.status_operacional === 'Ativo');
            
            // Gera hor√°rios de hora cheia e meia hora para a fila
            const gerarHorariosFila = () => {
                const horarios = [];
                for (let h = 6; h < 22; h++) {
                    horarios.push(`${String(h).padStart(2, '0')}:00`);
                    horarios.push(`${String(h).padStart(2, '0')}:30`);
                }
                return horarios;
            };
            
            // Verifica se usu√°rio j√° est√° na fila para este hor√°rio
            const jaEstaNaFila = filaEspera.some(f => 
                f.id_usuario === currentUser.id && 
                f.id_modulo === modulo.id &&
                f.data === selectedData &&
                f.horario_desejado === selectedHorario &&
                f.status === 'Aguardando'
            );
            
            const handleEntrar = () => {
                const novaEntradaFila = {
                    id: Date.now(),
                    id_modulo: modulo.id,
                    id_recurso: tipoEspera === 'especifica' ? selectedRecurso.id : null,
                    id_usuario: currentUser.id,
                    data: selectedData,
                    horario_desejado: selectedHorario,
                    created_at: new Date().toISOString(),
                    status: 'Aguardando',
                    tipo_entrada: modulo.tipo_fila
                };
                onEntrar(novaEntradaFila);
            };
            
            return (
                <div className="p-4 space-y-4">
                    <button onClick={onVoltar} className="flex items-center gap-2 text-slate-600 font-medium">
                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                        </svg>
                        Voltar
                    </button>
                    
                    <div className="flex items-center gap-3">
                        <div className="relative">
                            <span className="text-3xl">{modulo.icone}</span>
                            <span className="absolute -top-1 -right-1 text-lg">‚è≥</span>
                        </div>
                        <div>
                            <h2 className="text-xl font-bold text-slate-800">Fila de Espera</h2>
                            <p className="text-sm text-slate-500">{modulo.nome_categoria}</p>
                        </div>
                    </div>
                    
                    <Card className="p-4 bg-purple-50 border-purple-200">
                        <p className="text-sm text-purple-700">
                            {modulo.tipo_fila === 'checkin' 
                                ? `üìç Check-in presencial - Voc√™ precisa estar no clube at√© ${modulo.antecedencia_fila_minutos} minutos antes do hor√°rio.`
                                : `üìÖ Agendamento antecipado - Reserve sua posi√ß√£o na fila para o hor√°rio desejado.`
                            }
                        </p>
                    </Card>
                    
                    {/* Tipo de espera */}
                    <div className="space-y-3">
                        <h3 className="font-semibold text-slate-700">O que voc√™ prefere?</h3>
                        
                        <Card 
                            className={`p-4 border-2 cursor-pointer transition-all ${tipoEspera === 'qualquer' ? 'border-purple-500 bg-purple-50' : 'border-transparent'}`}
                            onClick={() => { setTipoEspera('qualquer'); setSelectedRecurso(null); }}
                        >
                            <div className="flex items-center gap-3">
                                <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${tipoEspera === 'qualquer' ? 'border-purple-500' : 'border-slate-300'}`}>
                                    {tipoEspera === 'qualquer' && <div className="w-3 h-3 bg-purple-500 rounded-full" />}
                                </div>
                                <div>
                                    <p className="font-semibold text-slate-800">Qualquer {modulo.nome_categoria === 'T√™nis' ? 'quadra' : 'local'}</p>
                                    <p className="text-sm text-slate-500">Primeira que vagar</p>
                                </div>
                            </div>
                        </Card>
                        
                        <Card 
                            className={`p-4 border-2 cursor-pointer transition-all ${tipoEspera === 'especifica' ? 'border-purple-500 bg-purple-50' : 'border-transparent'}`}
                            onClick={() => setTipoEspera('especifica')}
                        >
                            <div className="flex items-center gap-3">
                                <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${tipoEspera === 'especifica' ? 'border-purple-500' : 'border-slate-300'}`}>
                                    {tipoEspera === 'especifica' && <div className="w-3 h-3 bg-purple-500 rounded-full" />}
                                </div>
                                <div>
                                    <p className="font-semibold text-slate-800">{modulo.nome_categoria === 'T√™nis' ? 'Quadra' : 'Local'} espec√≠fica</p>
                                    <p className="text-sm text-slate-500">Escolher qual prefiro</p>
                                </div>
                            </div>
                        </Card>
                    </div>
                    
                    {/* Sele√ß√£o de quadra espec√≠fica */}
                    {tipoEspera === 'especifica' && (
                        <div className="space-y-2">
                            <h4 className="text-sm font-medium text-slate-700">Escolha:</h4>
                            <div className="grid grid-cols-1 gap-2">
                                {recursosDoModulo.map(recurso => (
                                    <button
                                        key={recurso.id}
                                        onClick={() => setSelectedRecurso(recurso)}
                                        className={`p-3 rounded-xl text-left transition-all ${
                                            selectedRecurso?.id === recurso.id 
                                                ? 'bg-purple-100 border-2 border-purple-500' 
                                                : 'bg-slate-50 border-2 border-transparent'
                                        }`}
                                    >
                                        <p className="font-medium text-slate-800">{recurso.nome_identificador}</p>
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}
                    
                    {/* Data */}
                    {modulo.tipo_fila === 'agendamento' && (
                        <div className="space-y-2">
                            <h4 className="text-sm font-medium text-slate-700">Data:</h4>
                            <Input 
                                type="date"
                                value={selectedData}
                                onChange={(e) => setSelectedData(e.target.value)}
                                min={formatDate(new Date())}
                            />
                        </div>
                    )}
                    
                    {/* Hor√°rio desejado */}
                    <div className="space-y-2">
                        <h4 className="text-sm font-medium text-slate-700">Hor√°rio desejado:</h4>
                        <div className="grid grid-cols-4 gap-2 max-h-48 overflow-y-auto">
                            {gerarHorariosFila().map(horario => (
                                <button
                                    key={horario}
                                    onClick={() => setSelectedHorario(horario)}
                                    className={`p-2 rounded-xl text-sm font-medium transition-all ${
                                        selectedHorario === horario
                                            ? 'bg-purple-500 text-white'
                                            : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                    }`}
                                >
                                    {horario}
                                </button>
                            ))}
                        </div>
                    </div>
                    
                    {jaEstaNaFila && (
                        <div className="bg-amber-50 p-3 rounded-xl text-sm text-amber-700">
                            ‚ö†Ô∏è Voc√™ j√° est√° na fila para este hor√°rio!
                        </div>
                    )}
                    
                    <Button 
                        variant="purple"
                        className="w-full"
                        disabled={!selectedHorario || (tipoEspera === 'especifica' && !selectedRecurso) || jaEstaNaFila}
                        onClick={handleEntrar}
                    >
                        Entrar na Fila de Espera
                    </Button>
                </div>
            );
        };

        // TELA DE FILA DE ESPERA (VISUALIZA√á√ÉO)
        const TelaFilaEspera = ({ 
            modulos, 
            recursos, 
            filaEspera, 
            currentUser, 
            usuarios,
            onCancelarFila, 
            onAdicionarNaFila,
            onAtribuirDaFila 
        }) => {
            const [showModalAdicionar, setShowModalAdicionar] = useState(false);
            const [moduloSelecionado, setModuloSelecionado] = useState(null);
            
            const isStaff = currentUser.role === 'Admin' || currentUser.role === 'Funcionario';
            const modulosComFila = modulos.filter(m => m.status_ativo && m.fila_habilitada);
            const hoje = formatDate(new Date());
            
            // Filtra filas do usu√°rio ou todas se for funcion√°rio
            const filasVisiveis = isStaff 
                ? filaEspera.filter(f => f.status === 'Aguardando')
                : filaEspera.filter(f => f.id_usuario === currentUser.id);
            
            const getUsuario = (id) => usuarios.find(u => u.id === id);
            const getRecurso = (id) => recursos.find(r => r.id === id);
            const getModulo = (id) => modulos.find(m => m.id === id);
            
            // Agrupa fila por m√≥dulo
            const filasPorModulo = modulosComFila.map(modulo => ({
                modulo,
                filas: filasVisiveis.filter(f => f.id_modulo === modulo.id).sort((a, b) => new Date(a.created_at) - new Date(b.created_at))
            })).filter(g => g.filas.length > 0 || isStaff);
            
            return (
                <div className="p-4 space-y-4 pb-24">
                    <div className="flex items-center justify-between">
                        <div>
                            <h2 className="text-xl font-bold text-slate-800">‚è≥ Fila de Espera</h2>
                            <p className="text-sm text-slate-500">
                                {isStaff ? 'Gerencie as filas de espera' : 'Suas posi√ß√µes na fila'}
                            </p>
                        </div>
                        
                        {isStaff && (
                            <Button variant="purple" size="sm" onClick={() => setShowModalAdicionar(true)}>
                                + Adicionar
                            </Button>
                        )}
                    </div>
                    
                    {filasPorModulo.length === 0 && (
                        <Card className="p-8 text-center">
                            <span className="text-4xl mb-4 block">‚è≥</span>
                            <p className="text-slate-500">
                                {isStaff ? 'Nenhuma pessoa na fila no momento' : 'Voc√™ n√£o est√° em nenhuma fila'}
                            </p>
                        </Card>
                    )}
                    
                    {filasPorModulo.map(({ modulo, filas }) => (
                        <Card key={modulo.id} className="p-4">
                            <div className="flex items-center gap-2 mb-3">
                                <span className="text-xl">{modulo.icone}</span>
                                <h3 className="font-semibold text-slate-800">{modulo.nome_categoria}</h3>
                                <Badge variant={modulo.tipo_fila === 'checkin' ? 'info' : 'purple'} size="sm">
                                    {modulo.tipo_fila === 'checkin' ? 'Check-in' : 'Agendamento'}
                                </Badge>
                            </div>
                            
                            {filas.length === 0 ? (
                                <p className="text-sm text-slate-400 text-center py-4">Fila vazia</p>
                            ) : (
                                <div className="space-y-2">
                                    {filas.map((fila, index) => {
                                        const usuario = getUsuario(fila.id_usuario);
                                        const recurso = fila.id_recurso ? getRecurso(fila.id_recurso) : null;
                                        
                                        return (
                                            <div 
                                                key={fila.id} 
                                                className={`p-3 rounded-xl ${
                                                    fila.id_usuario === currentUser.id ? 'bg-purple-50 border border-purple-200' : 'bg-slate-50'
                                                }`}
                                            >
                                                <div className="flex items-center justify-between">
                                                    <div className="flex items-center gap-3">
                                                        <div className="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-purple-700 font-bold text-sm">
                                                            {index + 1}¬∫
                                                        </div>
                                                        <div>
                                                            <p className="font-medium text-slate-800">
                                                                {isStaff ? usuario?.nome : (fila.id_usuario === currentUser.id ? 'Voc√™' : `Posi√ß√£o ${index + 1}`)}
                                                            </p>
                                                            <p className="text-xs text-slate-500">
                                                                {recurso ? recurso.nome_identificador : 'Qualquer'}
                                                                {' ‚Ä¢ '}{fila.horario_desejado}
                                                                {fila.data !== hoje && ` ‚Ä¢ ${formatDateBR(fila.data)}`}
                                                            </p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="flex items-center gap-2">
                                                        <StatusBadge status={fila.status} />
                                                        
                                                        {fila.status === 'Aguardando' && (
                                                            <>
                                                                {isStaff && (
                                                                    <Button 
                                                                        variant="success" 
                                                                        size="sm"
                                                                        onClick={() => onAtribuirDaFila(fila)}
                                                                    >
                                                                        Atribuir
                                                                    </Button>
                                                                )}
                                                                {(fila.id_usuario === currentUser.id || isStaff) && (
                                                                    <Button 
                                                                        variant="danger" 
                                                                        size="sm"
                                                                        onClick={() => onCancelarFila(fila.id)}
                                                                    >
                                                                        ‚úï
                                                                    </Button>
                                                                )}
                                                            </>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </Card>
                    ))}
                    
                    {/* Modal para funcion√°rio adicionar pessoa na fila */}
                    <Modal isOpen={showModalAdicionar} onClose={() => setShowModalAdicionar(false)} title="Adicionar √† Fila">
                        <ModalAdicionarFila 
                            modulos={modulosComFila}
                            recursos={recursos}
                            usuarios={usuarios.filter(u => u.role === 'Socio')}
                            onAdicionar={(entrada) => { onAdicionarNaFila(entrada); setShowModalAdicionar(false); }}
                        />
                    </Modal>
                </div>
            );
        };

        // Modal para adicionar pessoa na fila (funcion√°rio/admin)
        const ModalAdicionarFila = ({ modulos, recursos, usuarios, onAdicionar }) => {
            const [selectedModulo, setSelectedModulo] = useState(null);
            const [selectedUsuario, setSelectedUsuario] = useState(null);
            const [tipoEspera, setTipoEspera] = useState('qualquer');
            const [selectedRecurso, setSelectedRecurso] = useState(null);
            const [selectedHorario, setSelectedHorario] = useState('08:00');
            const [selectedData, setSelectedData] = useState(formatDate(new Date()));
            
            const recursosDoModulo = selectedModulo 
                ? recursos.filter(r => r.id_modulo === selectedModulo.id && r.status_operacional === 'Ativo')
                : [];
            
            const gerarHorariosFila = () => {
                const horarios = [];
                for (let h = 6; h < 22; h++) {
                    horarios.push(`${String(h).padStart(2, '0')}:00`);
                    horarios.push(`${String(h).padStart(2, '0')}:30`);
                }
                return horarios;
            };
            
            const handleAdicionar = () => {
                const novaEntrada = {
                    id: Date.now(),
                    id_modulo: selectedModulo.id,
                    id_recurso: tipoEspera === 'especifica' ? selectedRecurso.id : null,
                    id_usuario: selectedUsuario.id,
                    data: selectedData,
                    horario_desejado: selectedHorario,
                    created_at: new Date().toISOString(),
                    status: 'Aguardando',
                    tipo_entrada: selectedModulo.tipo_fila
                };
                onAdicionar(novaEntrada);
            };
            
            return (
                <div className="space-y-4">
                    <Select 
                        label="M√≥dulo"
                        options={[
                            { value: '', label: 'Selecione...' },
                            ...modulos.map(m => ({ value: m.id, label: `${m.icone} ${m.nome_categoria}` }))
                        ]}
                        onChange={(e) => setSelectedModulo(modulos.find(m => m.id === parseInt(e.target.value)))}
                    />
                    
                    <Select 
                        label="S√≥cio"
                        options={[
                            { value: '', label: 'Selecione...' },
                            ...usuarios.map(u => ({ value: u.id, label: `${u.nome} (${u.matricula})` }))
                        ]}
                        onChange={(e) => setSelectedUsuario(usuarios.find(u => u.id === parseInt(e.target.value)))}
                    />
                    
                    {selectedModulo && (
                        <>
                            <div className="space-y-2">
                                <label className="text-sm font-medium text-slate-700">Tipo de espera:</label>
                                <div className="flex gap-2">
                                    <Button 
                                        variant={tipoEspera === 'qualquer' ? 'purple' : 'secondary'} 
                                        size="sm"
                                        onClick={() => { setTipoEspera('qualquer'); setSelectedRecurso(null); }}
                                    >
                                        Qualquer
                                    </Button>
                                    <Button 
                                        variant={tipoEspera === 'especifica' ? 'purple' : 'secondary'} 
                                        size="sm"
                                        onClick={() => setTipoEspera('especifica')}
                                    >
                                        Espec√≠fico
                                    </Button>
                                </div>
                            </div>
                            
                            {tipoEspera === 'especifica' && (
                                <Select 
                                    label="Local"
                                    options={[
                                        { value: '', label: 'Selecione...' },
                                        ...recursosDoModulo.map(r => ({ value: r.id, label: r.nome_identificador }))
                                    ]}
                                    onChange={(e) => setSelectedRecurso(recursosDoModulo.find(r => r.id === parseInt(e.target.value)))}
                                />
                            )}
                            
                            {selectedModulo.tipo_fila === 'agendamento' && (
                                <Input 
                                    type="date"
                                    label="Data"
                                    value={selectedData}
                                    onChange={(e) => setSelectedData(e.target.value)}
                                    min={formatDate(new Date())}
                                />
                            )}
                            
                            <Select 
                                label="Hor√°rio desejado"
                                options={gerarHorariosFila().map(h => ({ value: h, label: h }))}
                                value={selectedHorario}
                                onChange={(e) => setSelectedHorario(e.target.value)}
                            />
                        </>
                    )}
                    
                    <Button 
                        variant="purple"
                        className="w-full"
                        disabled={!selectedModulo || !selectedUsuario || !selectedHorario || (tipoEspera === 'especifica' && !selectedRecurso)}
                        onClick={handleAdicionar}
                    >
                        Adicionar √† Fila
                    </Button>
                </div>
            );
        };

        // MINHAS RESERVAS
        const MinhasReservas = ({ reservas, recursos, modulos, currentUser, onCancelar }) => {
            const [tab, setTab] = useState('proximas');
            const hoje = formatDate(new Date());
            
            const minhasReservas = reservas.filter(r => r.id_usuario === currentUser.id);
            const proximas = minhasReservas.filter(r => r.data >= hoje && r.status !== 'Cancelada' && r.status !== 'No-Show');
            const historico = minhasReservas.filter(r => r.data < hoje || r.status === 'Cancelada' || r.status === 'No-Show');
            
            const getRecurso = (id) => recursos.find(r => r.id === id);
            const getModulo = (recursoId) => {
                const recurso = getRecurso(recursoId);
                return modulos.find(m => m.id === recurso?.id_modulo);
            };
            
            const podeCancelar = (reserva) => {
                const modulo = getModulo(reserva.id_recurso);
                if (!modulo) return false;
                
                const now = new Date();
                const reservaDate = new Date(reserva.data + 'T' + reserva.hora_inicio);
                const diffHours = (reservaDate - now) / (1000 * 60 * 60);
                
                return diffHours >= modulo.janela_cancelamento && reserva.status !== 'Cancelada';
            };
            
            const reservasExibidas = tab === 'proximas' ? proximas : historico;
            
            return (
                <div className="p-4 space-y-4 pb-24">
                    <h2 className="text-xl font-bold text-slate-800">Minhas Reservas</h2>
                    
                    <TabBar 
                        tabs={[
                            { id: 'proximas', label: `Pr√≥ximas (${proximas.length})` },
                            { id: 'historico', label: `Hist√≥rico (${historico.length})` },
                        ]}
                        active={tab}
                        onChange={setTab}
                    />
                    
                    {reservasExibidas.length === 0 ? (
                        <Card className="p-8 text-center">
                            <p className="text-slate-500">
                                {tab === 'proximas' ? 'Nenhuma reserva agendada' : 'Nenhuma reserva no hist√≥rico'}
                            </p>
                        </Card>
                    ) : (
                        <div className="space-y-3">
                            {reservasExibidas.map(reserva => {
                                const recurso = getRecurso(reserva.id_recurso);
                                const modulo = getModulo(reserva.id_recurso);
                                
                                return (
                                    <Card key={reserva.id} className="p-4">
                                        <div className="flex items-start justify-between mb-2">
                                            <div className="flex items-center gap-2">
                                                <span className="text-xl">{modulo?.icone}</span>
                                                <div>
                                                    <h4 className="font-semibold text-slate-800">{recurso?.nome_identificador}</h4>
                                                    <p className="text-sm text-slate-500">{modulo?.nome_categoria}</p>
                                                </div>
                                            </div>
                                            <StatusBadge status={reserva.status} />
                                        </div>
                                        
                                        <div className="bg-slate-50 rounded-xl p-3 mb-3">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-slate-500">Data:</span>
                                                <span className="font-medium">{formatDateBR(reserva.data)}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-slate-500">Hor√°rio:</span>
                                                <span className="font-medium">{reserva.hora_inicio} - {reserva.hora_fim}</span>
                                            </div>
                                            {reserva.valor > 0 && (
                                                <div className="flex justify-between text-sm">
                                                    <span className="text-slate-500">Valor:</span>
                                                    <span className="font-medium">R$ {reserva.valor},00</span>
                                                </div>
                                            )}
                                        </div>
                                        
                                        {tab === 'proximas' && podeCancelar(reserva) && (
                                            <Button 
                                                variant="danger" 
                                                size="sm" 
                                                className="w-full"
                                                onClick={() => onCancelar(reserva.id)}
                                            >
                                                Cancelar Reserva
                                            </Button>
                                        )}
                                    </Card>
                                );
                            })}
                        </div>
                    )}
                </div>
            );
        };

        // LOUSA DIGITAL (FUNCION√ÅRIO/ADMIN)
        const LousaDigital = ({ 
            reservas, 
            recursos, 
            modulos, 
            usuarios,
            filaEspera,
            onConfirmarPresenca, 
            onRegistrarNoShow,
            onAprovarPagamento,
            onAtribuirDaFila
        }) => {
            const [moduloSelecionado, setModuloSelecionado] = useState(null);
            const [showModalFila, setShowModalFila] = useState(false);
            const [recursoParaFila, setRecursoParaFila] = useState(null);
            
            const hoje = formatDate(new Date());
            const modulosAtivos = modulos.filter(m => m.status_ativo);
            
            const getReservasDoRecurso = (recursoId) => {
                return reservas.filter(r => 
                    r.id_recurso === recursoId && 
                    r.data === hoje &&
                    r.status !== 'Cancelada'
                ).sort((a, b) => a.hora_inicio.localeCompare(b.hora_inicio));
            };
            
            const getUsuario = (id) => usuarios.find(u => u.id === id);
            
            const recursosExibidos = moduloSelecionado 
                ? recursos.filter(r => r.id_modulo === moduloSelecionado.id)
                : recursos.filter(r => modulosAtivos.some(m => m.id === r.id_modulo));
            
            // Fila de espera do dia
            const filaHoje = filaEspera.filter(f => f.data === hoje && f.status === 'Aguardando');
            
            // Obt√©m pr√≥ximo da fila para um recurso espec√≠fico ou qualquer recurso do m√≥dulo
            const getProximosDaFila = (recurso) => {
                const modulo = modulos.find(m => m.id === recurso.id_modulo);
                if (!modulo?.fila_habilitada) return [];
                
                return filaHoje
                    .filter(f => f.id_modulo === recurso.id_modulo && (f.id_recurso === null || f.id_recurso === recurso.id))
                    .sort((a, b) => {
                        // Prioridade: 1¬∫ quem pediu recurso espec√≠fico, 2¬∫ ordem de chegada
                        if (a.id_recurso === recurso.id && b.id_recurso !== recurso.id) return -1;
                        if (b.id_recurso === recurso.id && a.id_recurso !== recurso.id) return 1;
                        return new Date(a.created_at) - new Date(b.created_at);
                    });
            };
            
            const handleAbrirFila = (recurso) => {
                setRecursoParaFila(recurso);
                setShowModalFila(true);
            };
            
            return (
                <div className="p-4 space-y-4 pb-24">
                    <div className="flex items-center justify-between">
                        <h2 className="text-xl font-bold text-slate-800">Lousa Digital</h2>
                        <Badge variant="info">{formatDateBR(hoje)}</Badge>
                    </div>
                    
                    {/* Filtro por m√≥dulo */}
                    <div className="flex gap-2 overflow-x-auto pb-2">
                        <Button 
                            variant={moduloSelecionado === null ? 'primary' : 'secondary'}
                            size="sm"
                            onClick={() => setModuloSelecionado(null)}
                        >
                            Todos
                        </Button>
                        {modulosAtivos.map(modulo => (
                            <Button
                                key={modulo.id}
                                variant={moduloSelecionado?.id === modulo.id ? 'primary' : 'secondary'}
                                size="sm"
                                onClick={() => setModuloSelecionado(modulo)}
                            >
                                {modulo.icone} {modulo.nome_categoria}
                            </Button>
                        ))}
                    </div>
                    
                    {/* Resumo da fila */}
                    {filaHoje.length > 0 && (
                        <Card className="p-3 bg-purple-50 border-purple-200">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-2">
                                    <span className="text-lg">‚è≥</span>
                                    <span className="font-medium text-purple-800">{filaHoje.length} na fila de espera</span>
                                </div>
                                <Badge variant="purple">{filaHoje.length}</Badge>
                            </div>
                        </Card>
                    )}
                    
                    {/* Grid de Recursos */}
                    <div className="space-y-4">
                        {recursosExibidos.map(recurso => {
                            const modulo = modulos.find(m => m.id === recurso.id_modulo);
                            const reservasRecurso = getReservasDoRecurso(recurso.id);
                            const reservaAtual = reservasRecurso[0];
                            const proximosFila = getProximosDaFila(recurso);
                            
                            return (
                                <Card key={recurso.id} className={`p-4 ${recurso.status_operacional === 'Manutencao' ? 'opacity-50' : ''}`}>
                                    <div className="flex items-center justify-between mb-3">
                                        <div className="flex items-center gap-2">
                                            <span className="text-xl">{modulo?.icone}</span>
                                            <div>
                                                <h3 className="font-semibold text-slate-800">{recurso.nome_identificador}</h3>
                                                <div className="flex items-center gap-2">
                                                    <Badge 
                                                        variant={recurso.status_operacional === 'Ativo' ? 'success' : 'warning'}
                                                        size="sm"
                                                    >
                                                        {recurso.status_operacional}
                                                    </Badge>
                                                    {proximosFila.length > 0 && (
                                                        <Badge variant="purple" size="sm">
                                                            {proximosFila.length} na fila
                                                        </Badge>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {modulo?.fila_habilitada && (
                                            <Button variant="ghost" size="sm" onClick={() => handleAbrirFila(recurso)}>
                                                ‚è≥
                                            </Button>
                                        )}
                                    </div>
                                    
                                    {reservaAtual ? (
                                        <div className="space-y-3">
                                            <div className="bg-slate-50 p-3 rounded-xl">
                                                <div className="flex items-center justify-between mb-2">
                                                    <div>
                                                        <p className="font-medium text-slate-800">{getUsuario(reservaAtual.id_usuario)?.nome}</p>
                                                        <p className="text-sm text-slate-500">{reservaAtual.hora_inicio} - {reservaAtual.hora_fim}</p>
                                                    </div>
                                                    <StatusBadge status={reservaAtual.status} />
                                                </div>
                                                
                                                {reservaAtual.status === 'Confirmada' && (
                                                    <div className="space-y-1">
                                                        <div className="flex justify-between text-xs text-slate-500">
                                                            <span>Progresso</span>
                                                            <span>{getTimeProgress(reservaAtual.hora_inicio, reservaAtual.hora_fim)}%</span>
                                                        </div>
                                                        <ProgressBar 
                                                            value={getTimeProgress(reservaAtual.hora_inicio, reservaAtual.hora_fim)}
                                                            color={getProgressColor(getTimeProgress(reservaAtual.hora_inicio, reservaAtual.hora_fim))}
                                                        />
                                                    </div>
                                                )}
                                            </div>
                                            
                                            <div className="flex gap-2">
                                                {reservaAtual.status === 'Pendente' && (
                                                    <>
                                                        <Button 
                                                            variant="success" 
                                                            size="sm" 
                                                            className="flex-1"
                                                            onClick={() => onConfirmarPresenca(reservaAtual.id)}
                                                        >
                                                            ‚úì Confirmar
                                                        </Button>
                                                        <Button 
                                                            variant="danger" 
                                                            size="sm" 
                                                            className="flex-1"
                                                            onClick={() => onRegistrarNoShow(reservaAtual.id)}
                                                        >
                                                            ‚úó No-Show
                                                        </Button>
                                                    </>
                                                )}
                                                
                                                {reservaAtual.status === 'Aguardando Aprova√ß√£o' && (
                                                    <Button 
                                                        variant="success" 
                                                        size="sm" 
                                                        className="flex-1"
                                                        onClick={() => onAprovarPagamento(reservaAtual.id)}
                                                    >
                                                        üí∞ Aprovar Pagamento
                                                    </Button>
                                                )}
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center py-4 text-slate-400 bg-slate-50 rounded-xl">
                                            <p className="text-lg">‚úì</p>
                                            <p className="text-sm">Livre</p>
                                            
                                            {proximosFila.length > 0 && (
                                                <Button 
                                                    variant="purple" 
                                                    size="sm" 
                                                    className="mt-2"
                                                    onClick={() => handleAbrirFila(recurso)}
                                                >
                                                    Atribuir da Fila
                                                </Button>
                                            )}
                                        </div>
                                    )}
                                </Card>
                            );
                        })}
                    </div>
                    
                    {/* Modal de Fila do Recurso */}
                    <Modal 
                        isOpen={showModalFila} 
                        onClose={() => setShowModalFila(false)} 
                        title={`Fila - ${recursoParaFila?.nome_identificador || ''}`}
                    >
                        {recursoParaFila && (
                            <div className="space-y-3">
                                {getProximosDaFila(recursoParaFila).length === 0 ? (
                                    <p className="text-center text-slate-500 py-4">Nenhuma pessoa na fila</p>
                                ) : (
                                    getProximosDaFila(recursoParaFila).map((fila, index) => {
                                        const usuario = getUsuario(fila.id_usuario);
                                        return (
                                            <div key={fila.id} className="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                                                <div className="flex items-center gap-3">
                                                    <div className="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-purple-700 font-bold text-sm">
                                                        {index + 1}¬∫
                                                    </div>
                                                    <div>
                                                        <p className="font-medium text-slate-800">{usuario?.nome}</p>
                                                        <p className="text-xs text-slate-500">
                                                            {fila.id_recurso ? 'Espec√≠fico' : 'Qualquer'} ‚Ä¢ {fila.horario_desejado}
                                                        </p>
                                                    </div>
                                                </div>
                                                <Button 
                                                    variant="success" 
                                                    size="sm"
                                                    onClick={() => {
                                                        onAtribuirDaFila(fila, recursoParaFila);
                                                        setShowModalFila(false);
                                                    }}
                                                >
                                                    Atribuir
                                                </Button>
                                            </div>
                                        );
                                    })
                                )}
                            </div>
                        )}
                    </Modal>
                </div>
            );
        };

        // PAINEL DE CONFIGURA√á√ïES (ADMIN)
        const PainelConfig = ({ config, modulos, usuarios, onUpdateConfig, onUpdateModulo }) => {
            const [activeTab, setActiveTab] = useState('modulos');
            const [editingModulo, setEditingModulo] = useState(null);
            const [masterPassword, setMasterPassword] = useState('');
            const [isUnlocked, setIsUnlocked] = useState(false);
            
            if (!isUnlocked) {
                return (
                    <div className="p-4">
                        <Card className="p-6 text-center">
                            <div className="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg className="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                            </div>
                            <h3 className="text-lg font-bold text-slate-800 mb-2">√Årea Protegida</h3>
                            <p className="text-sm text-slate-500 mb-4">Digite a senha master para acessar as configura√ß√µes.</p>
                            
                            <Input 
                                type="password"
                                placeholder="Senha master"
                                value={masterPassword}
                                onChange={(e) => setMasterPassword(e.target.value)}
                            />
                            
                            <Button onClick={() => masterPassword === '1234' && setIsUnlocked(true)} className="w-full mt-4">
                                Desbloquear
                            </Button>
                            
                            <p className="text-xs text-slate-400 mt-4">Demo: senha √© 1234</p>
                        </Card>
                    </div>
                );
            }
            
            return (
                <div className="p-4 space-y-4 pb-24">
                    <h2 className="text-xl font-bold text-slate-800">Configura√ß√µes</h2>
                    
                    <TabBar 
                        tabs={[
                            { id: 'modulos', label: 'M√≥dulos' },
                            { id: 'fila', label: 'Fila' },
                            { id: 'clube', label: 'Clube' },
                            { id: 'usuarios', label: 'Usu√°rios' },
                        ]}
                        active={activeTab}
                        onChange={setActiveTab}
                    />
                    
                    {/* TAB: M√ìDULOS */}
                    {activeTab === 'modulos' && (
                        <div className="space-y-4">
                            <p className="text-sm text-slate-500">Ative/desative m√≥dulos e configure regras de uso.</p>
                            
                            {modulos.map(modulo => (
                                <Card key={modulo.id} className="p-4">
                                    <div className="flex items-center justify-between mb-3">
                                        <div className="flex items-center gap-3">
                                            <span className="text-2xl">{modulo.icone}</span>
                                            <div>
                                                <h3 className="font-semibold text-slate-800">{modulo.nome_categoria}</h3>
                                                <div className="flex gap-1">
                                                    <Badge variant={modulo.tipo_cobranca === 'Pago' ? 'warning' : 'default'} size="sm">
                                                        {modulo.tipo_cobranca}
                                                    </Badge>
                                                    {modulo.fila_habilitada && (
                                                        <Badge variant="purple" size="sm">Fila</Badge>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                        <Toggle 
                                            checked={modulo.status_ativo}
                                            onChange={(checked) => onUpdateModulo(modulo.id, { status_ativo: checked })}
                                        />
                                    </div>
                                    
                                    <Button 
                                        variant="ghost" 
                                        size="sm" 
                                        className="w-full"
                                        onClick={() => setEditingModulo(modulo)}
                                    >
                                        ‚öôÔ∏è Editar Regras
                                    </Button>
                                </Card>
                            ))}
                        </div>
                    )}
                    
                    {/* TAB: FILA */}
                    {activeTab === 'fila' && (
                        <div className="space-y-4">
                            <p className="text-sm text-slate-500">Configure a fila de espera por m√≥dulo.</p>
                            
                            {modulos.filter(m => m.tipo_cobranca === 'Gratuito').map(modulo => (
                                <Card key={modulo.id} className="p-4">
                                    <div className="flex items-center justify-between mb-4">
                                        <div className="flex items-center gap-3">
                                            <span className="text-2xl">{modulo.icone}</span>
                                            <h3 className="font-semibold text-slate-800">{modulo.nome_categoria}</h3>
                                        </div>
                                        <Toggle 
                                            checked={modulo.fila_habilitada}
                                            onChange={(checked) => onUpdateModulo(modulo.id, { fila_habilitada: checked })}
                                        />
                                    </div>
                                    
                                    {modulo.fila_habilitada && (
                                        <div className="space-y-3 pt-3 border-t border-slate-100">
                                            <div>
                                                <label className="text-sm font-medium text-slate-700 mb-2 block">Tipo de Fila:</label>
                                                <div className="flex gap-2">
                                                    <Button 
                                                        variant={modulo.tipo_fila === 'checkin' ? 'primary' : 'secondary'} 
                                                        size="sm"
                                                        onClick={() => onUpdateModulo(modulo.id, { tipo_fila: 'checkin' })}
                                                    >
                                                        üìç Check-in
                                                    </Button>
                                                    <Button 
                                                        variant={modulo.tipo_fila === 'agendamento' ? 'primary' : 'secondary'} 
                                                        size="sm"
                                                        onClick={() => onUpdateModulo(modulo.id, { tipo_fila: 'agendamento' })}
                                                    >
                                                        üìÖ Agendamento
                                                    </Button>
                                                </div>
                                            </div>
                                            
                                            <Input 
                                                type="number"
                                                label="Anteced√™ncia m√≠nima (minutos)"
                                                value={modulo.antecedencia_fila_minutos}
                                                onChange={(e) => onUpdateModulo(modulo.id, { antecedencia_fila_minutos: parseInt(e.target.value) || 0 })}
                                                min="0"
                                            />
                                            
                                            <div className="text-xs text-slate-500 bg-slate-50 p-2 rounded-lg">
                                                {modulo.tipo_fila === 'checkin' 
                                                    ? `S√≥cio deve fazer check-in at√© ${modulo.antecedencia_fila_minutos} min antes do hor√°rio desejado.`
                                                    : `S√≥cio pode agendar posi√ß√£o na fila com at√© ${modulo.antecedencia_fila_minutos} min de anteced√™ncia.`
                                                }
                                            </div>
                                        </div>
                                    )}
                                </Card>
                            ))}
                        </div>
                    )}
                    
                    {/* TAB: CLUBE */}
                    {activeTab === 'clube' && (
                        <div className="space-y-4">
                            <Card className="p-4 space-y-4">
                                <Input 
                                    label="Nome do Clube"
                                    value={config.nome_clube}
                                    onChange={(e) => onUpdateConfig({ nome_clube: e.target.value })}
                                />
                                
                                <Input 
                                    label="Chave PIX"
                                    value={config.pix_chave}
                                    onChange={(e) => onUpdateConfig({ pix_chave: e.target.value })}
                                />
                                
                                <Input 
                                    type="number"
                                    label="Limite de No-Shows"
                                    value={config.punicao_noshow_limite}
                                    onChange={(e) => onUpdateConfig({ punicao_noshow_limite: parseInt(e.target.value) || 3 })}
                                />
                                
                                <Input 
                                    type="number"
                                    label="Dias de Bloqueio (puni√ß√£o)"
                                    value={config.punicao_dias_bloqueio}
                                    onChange={(e) => onUpdateConfig({ punicao_dias_bloqueio: parseInt(e.target.value) || 7 })}
                                />
                            </Card>
                        </div>
                    )}
                    
                    {/* TAB: USU√ÅRIOS */}
                    {activeTab === 'usuarios' && (
                        <div className="space-y-3">
                            {usuarios.map(user => (
                                <Card key={user.id} className="p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <h4 className="font-semibold text-slate-800">{user.nome}</h4>
                                            <p className="text-sm text-slate-500">{user.matricula}</p>
                                        </div>
                                        <div className="text-right">
                                            <Badge variant={user.role === 'Admin' ? 'purple' : user.role === 'Funcionario' ? 'info' : 'success'}>
                                                {user.role}
                                            </Badge>
                                            {user.role === 'Socio' && (
                                                <p className="text-xs text-slate-400 mt-1">
                                                    No-Shows: {user.contador_noshow}
                                                </p>
                                            )}
                                        </div>
                                    </div>
                                </Card>
                            ))}
                        </div>
                    )}
                    
                    {/* Modal de Edi√ß√£o de M√≥dulo */}
                    <Modal 
                        isOpen={!!editingModulo} 
                        onClose={() => setEditingModulo(null)}
                        title={`Editar ${editingModulo?.nome_categoria}`}
                    >
                        {editingModulo && (
                            <div className="space-y-4">
                                <Select 
                                    label="Tipo de Cobran√ßa"
                                    options={[
                                        { value: 'Gratuito', label: 'Gratuito' },
                                        { value: 'Pago', label: 'Pago' },
                                    ]}
                                    value={editingModulo.tipo_cobranca}
                                    onChange={(e) => setEditingModulo({...editingModulo, tipo_cobranca: e.target.value})}
                                />
                                
                                {editingModulo.tipo_cobranca === 'Pago' && (
                                    <Input 
                                        type="number"
                                        label="Valor (R$)"
                                        value={editingModulo.valor_padrao}
                                        onChange={(e) => setEditingModulo({...editingModulo, valor_padrao: parseFloat(e.target.value) || 0})}
                                    />
                                )}
                                
                                <Select 
                                    label="Tempo de Uso"
                                    options={[
                                        { value: '30', label: '30 minutos' },
                                        { value: '60', label: '1 hora' },
                                        { value: '90', label: '1h30' },
                                        { value: '120', label: '2 horas' },
                                        { value: 'Di√°ria', label: 'Di√°ria' },
                                    ]}
                                    value={String(editingModulo.unidade_tempo)}
                                    onChange={(e) => setEditingModulo({
                                        ...editingModulo, 
                                        unidade_tempo: e.target.value === 'Di√°ria' ? 'Di√°ria' : parseInt(e.target.value)
                                    })}
                                />
                                
                                <Input 
                                    type="number"
                                    label="Anteced√™ncia M√°xima (horas)"
                                    value={editingModulo.antecedencia_maxima}
                                    onChange={(e) => setEditingModulo({...editingModulo, antecedencia_maxima: parseInt(e.target.value) || 24})}
                                />
                                
                                <Input 
                                    type="number"
                                    label="Janela de Cancelamento (horas)"
                                    value={editingModulo.janela_cancelamento}
                                    onChange={(e) => setEditingModulo({...editingModulo, janela_cancelamento: parseInt(e.target.value) || 2})}
                                />
                                
                                <Button 
                                    className="w-full"
                                    onClick={() => {
                                        onUpdateModulo(editingModulo.id, editingModulo);
                                        setEditingModulo(null);
                                    }}
                                >
                                    Salvar Altera√ß√µes
                                </Button>
                            </div>
                        )}
                    </Modal>
                </div>
            );
        };

        // ============================================
        // APP PRINCIPAL
        // ============================================
        const App = () => {
            // Estados
            const [currentUser, setCurrentUser] = useState(null);
            const [currentView, setCurrentView] = useState('home');
            const [selectedModulo, setSelectedModulo] = useState(null);
            const [showFilaModal, setShowFilaModal] = useState(false);
            const [moduloParaFila, setModuloParaFila] = useState(null);
            
            // Dados
            const [config, setConfig] = useState(initialConfigGlobal);
            const [modulos, setModulos] = useState(initialModulos);
            const [recursos, setRecursos] = useState(initialRecursos);
            const [usuarios, setUsuarios] = useState(initialUsuarios);
            const [reservas, setReservas] = useState(generateInitialReservas);
            const [filaEspera, setFilaEspera] = useState(generateInitialFilaEspera);
            
            // Notifica√ß√µes
            const [notification, setNotification] = useState(null);
            
            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
            };
            
            // Handlers
            const handleLogin = (user) => {
                setCurrentUser(user);
                setCurrentView('home');
            };
            
            const handleLogout = () => {
                setCurrentUser(null);
                setCurrentView('home');
                setSelectedModulo(null);
            };
            
            const handleSelectModulo = (modulo) => {
                setSelectedModulo(modulo);
            };
            
            const handleVoltar = () => {
                setSelectedModulo(null);
                setModuloParaFila(null);
            };
            
            const handleReservar = (novaReserva) => {
                setReservas([...reservas, novaReserva]);
                setSelectedModulo(null);
                showNotification('Reserva realizada com sucesso!');
                setCurrentView('reservas');
            };
            
            const handleCancelarReserva = (reservaId) => {
                setReservas(reservas.map(r => 
                    r.id === reservaId ? {...r, status: 'Cancelada'} : r
                ));
                showNotification('Reserva cancelada.', 'warning');
            };
            
            const handleConfirmarPresenca = (reservaId) => {
                setReservas(reservas.map(r => 
                    r.id === reservaId ? {...r, status: 'Confirmada'} : r
                ));
                showNotification('Presen√ßa confirmada!');
            };
            
            const handleRegistrarNoShow = (reservaId) => {
                const reserva = reservas.find(r => r.id === reservaId);
                if (reserva) {
                    setReservas(reservas.map(r => 
                        r.id === reservaId ? {...r, status: 'No-Show'} : r
                    ));
                    setUsuarios(usuarios.map(u => 
                        u.id === reserva.id_usuario ? {...u, contador_noshow: u.contador_noshow + 1} : u
                    ));
                    showNotification('No-Show registrado.', 'warning');
                }
            };
            
            const handleAprovarPagamento = (reservaId) => {
                setReservas(reservas.map(r => 
                    r.id === reservaId ? {...r, status: 'Confirmada'} : r
                ));
                showNotification('Pagamento aprovado!');
            };
            
            const handleUpdateConfig = (updates) => {
                setConfig({...config, ...updates});
                showNotification('Configura√ß√µes atualizadas!');
            };
            
            const handleUpdateModulo = (moduloId, updates) => {
                setModulos(modulos.map(m => 
                    m.id === moduloId ? {...m, ...updates} : m
                ));
            };
            
            // Handlers de Fila
            const handleEntrarFila = (modulo) => {
                setModuloParaFila(modulo);
            };
            
            const handleConfirmarEntradaFila = (novaEntrada) => {
                setFilaEspera([...filaEspera, novaEntrada]);
                setModuloParaFila(null);
                showNotification('Voc√™ entrou na fila de espera!');
                setCurrentView('fila');
            };
            
            const handleCancelarFila = (filaId) => {
                setFilaEspera(filaEspera.map(f => 
                    f.id === filaId ? {...f, status: 'Cancelado'} : f
                ));
                showNotification('Saiu da fila de espera.', 'warning');
            };
            
            const handleAdicionarNaFila = (novaEntrada) => {
                setFilaEspera([...filaEspera, novaEntrada]);
                showNotification('Pessoa adicionada √† fila!');
            };
            
            const handleAtribuirDaFila = (fila, recurso) => {
                const modulo = modulos.find(m => m.id === fila.id_modulo);
                const recursoAtribuido = recurso || recursos.find(r => r.id === fila.id_recurso) || 
                    recursos.find(r => r.id_modulo === fila.id_modulo && r.status_operacional === 'Ativo');
                
                if (!recursoAtribuido) {
                    showNotification('Nenhum recurso dispon√≠vel!', 'error');
                    return;
                }
                
                // Calcula hora fim
                const duracao = typeof modulo.unidade_tempo === 'number' ? modulo.unidade_tempo : 60;
                const [h, m] = fila.horario_desejado.split(':').map(Number);
                const fimMinutos = h * 60 + m + duracao;
                const horaFim = `${String(Math.floor(fimMinutos / 60)).padStart(2, '0')}:${String(fimMinutos % 60).padStart(2, '0')}`;
                
                // Cria reserva
                const novaReserva = {
                    id: Date.now(),
                    id_recurso: recursoAtribuido.id,
                    id_usuario: fila.id_usuario,
                    data: fila.data,
                    hora_inicio: fila.horario_desejado,
                    hora_fim: horaFim,
                    status: 'Pendente',
                    url_comprovante_pix: null,
                    valor: 0
                };
                
                setReservas([...reservas, novaReserva]);
                setFilaEspera(filaEspera.map(f => 
                    f.id === fila.id ? {...f, status: 'Atendido'} : f
                ));
                
                showNotification(`Reserva criada para ${usuarios.find(u => u.id === fila.id_usuario)?.nome}!`);
            };
            
            // Renderiza√ß√£o
            if (!currentUser) {
                return <TelaLogin usuarios={usuarios} onLogin={handleLogin} />;
            }
            
            return (
                <div className="min-h-screen bg-slate-50">
                    <Header currentUser={currentUser} onLogout={handleLogout} />
                    
                    <main className="max-w-7xl mx-auto pb-20">
                        {/* Home */}
                        {currentView === 'home' && !selectedModulo && !moduloParaFila && (
                            <HomeSocio modulos={modulos} onSelectModulo={handleSelectModulo} />
                        )}
                        
                        {/* Reservar Recurso */}
                        {currentView === 'home' && selectedModulo && !moduloParaFila && (
                            <ReservaRecurso 
                                modulo={selectedModulo}
                                recursos={recursos}
                                reservas={reservas}
                                currentUser={currentUser}
                                onReservar={handleReservar}
                                onVoltar={handleVoltar}
                                onEntrarFila={handleEntrarFila}
                            />
                        )}
                        
                        {/* Entrar na Fila */}
                        {moduloParaFila && (
                            <TelaEntrarFila 
                                modulo={moduloParaFila}
                                recursos={recursos}
                                currentUser={currentUser}
                                filaEspera={filaEspera}
                                onEntrar={handleConfirmarEntradaFila}
                                onVoltar={handleVoltar}
                            />
                        )}
                        
                        {/* Minhas Reservas */}
                        {currentView === 'reservas' && (
                            <MinhasReservas 
                                reservas={reservas}
                                recursos={recursos}
                                modulos={modulos}
                                currentUser={currentUser}
                                onCancelar={handleCancelarReserva}
                            />
                        )}
                        
                        {/* Fila de Espera */}
                        {currentView === 'fila' && (
                            <TelaFilaEspera 
                                modulos={modulos}
                                recursos={recursos}
                                filaEspera={filaEspera}
                                currentUser={currentUser}
                                usuarios={usuarios}
                                onCancelarFila={handleCancelarFila}
                                onAdicionarNaFila={handleAdicionarNaFila}
                                onAtribuirDaFila={handleAtribuirDaFila}
                            />
                        )}
                        
                        {/* Lousa Digital */}
                        {currentView === 'lousa' && (currentUser.role === 'Admin' || currentUser.role === 'Funcionario') && (
                            <LousaDigital 
                                reservas={reservas}
                                recursos={recursos}
                                modulos={modulos}
                                usuarios={usuarios}
                                filaEspera={filaEspera}
                                onConfirmarPresenca={handleConfirmarPresenca}
                                onRegistrarNoShow={handleRegistrarNoShow}
                                onAprovarPagamento={handleAprovarPagamento}
                                onAtribuirDaFila={handleAtribuirDaFila}
                            />
                        )}
                        
                        {/* Configura√ß√µes */}
                        {currentView === 'config' && currentUser.role === 'Admin' && (
                            <PainelConfig 
                                config={config}
                                modulos={modulos}
                                usuarios={usuarios}
                                onUpdateConfig={handleUpdateConfig}
                                onUpdateModulo={handleUpdateModulo}
                            />
                        )}
                    </main>
                    
                    <BottomNav 
                        currentView={currentView} 
                        onNavigate={(view) => { setCurrentView(view); setSelectedModulo(null); setModuloParaFila(null); }}
                        role={currentUser.role}
                    />
                    
                    {notification && (
                        <Notification 
                            message={notification.message}
                            type={notification.type}
                            onClose={() => setNotification(null)}
                        />
                    )}
                </div>
            );
        };

        // Renderiza o App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
